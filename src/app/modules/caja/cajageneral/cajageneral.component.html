<div class="container titulo">
  <h2 style="color:#3a6dbc">Caja General</h2>
</div>
<div class="container mt-3">
  <div class="text-right mt-3">
      <a mat-stroked-button color="accent" (click)="viewRegistrarCaja()">
          <i class="{{icono}}"></i> {{textbtn}}
      </a>
  </div>
  <mat-card *ngIf="viewFormulario" class="mat-elevation-z4 mt-3">
      <h3 style="color:#3a6dbc"><i class="fa fa-plus"></i> Nuevo Registro</h3>
      <form name="form" (ngSubmit)="f.form.valid && saveRegistroCaja()" #f="ngForm" novalidate>
          <div class="rowuno">
              <mat-form-field style="width:180px;">
                  <mat-label>Fecha</mat-label>
                  <input matInput [matDatepicker]="pickerF" (dateChange)="onChangeDateCaja($event)" [value]="today">
                  <mat-datepicker-toggle matSuffix [for]="pickerF"></mat-datepicker-toggle>
                  <mat-datepicker #pickerF></mat-datepicker>
              </mat-form-field>
          </div>
          <div class="rowuno">
              <div class="form-group tiporegistro">
                  <mat-form-field>
                      <mat-label for="tiporegistro_id">Tipo Registro</mat-label>
                      <mat-select name="tiporegistro_id" [(ngModel)]="newRegistroCaja.tiporegistro_id"
                          (ngModelChange)="changeTipoRegistro($event)" required>
                          <mat-option *ngFor="let tregistro of tipoRegistros;" [value]="tregistro.id">
                              {{tregistro.name}}
                          </mat-option>
                      </mat-select>
                  </mat-form-field>
              </div>
              <div class="form-group conceptos">
                  <mat-form-field>
                      <mat-label for="concepto_id">Concepto</mat-label>
                      <mat-select name="concepto_id" [(ngModel)]="newRegistroCaja.concepto_id"
                          (ngModelChange)="changeConceptos($event)" required>
                          <mat-option></mat-option>
                          <mat-option *ngFor="let concepto of conceptos;" [value]="concepto.id">
                              {{concepto.descripcion}}
                          </mat-option>
                      </mat-select>
                  </mat-form-field>
              </div>
              <div class="form-group subconceptos">
                  <mat-form-field>
                      <mat-label for="subconcepto_id">Subconcepto</mat-label>
                      <mat-select name="subconcepto_id" [(ngModel)]="newRegistroCaja.subconcepto_id" required>
                          <mat-option></mat-option>
                          <mat-option *ngFor="let subconcepto of subConceptos;" [value]="subconcepto.id">
                              {{subconcepto.descripcion}}
                          </mat-option>
                      </mat-select>
                  </mat-form-field>
              </div>             
          </div>
          <div class="rowdos">
              <div class="form-group tipocomprobante">
                  <mat-form-field>
                      <mat-label for="tipocomprobante_id">Tipo Comprobante</mat-label>
                      <mat-select name="tipocomprobante_id" [(ngModel)]="newRegistroCaja.tipocomprobante_id">
                          <mat-option></mat-option>
                          <mat-option *ngFor="let tc of tipoComprobantes;" [value]="tc.id">
                              {{tc.descripcion}}
                          </mat-option>
                      </mat-select>
                  </mat-form-field>
              </div>
              <div class="form-group nrocomprobante">
                  <mat-form-field>
                      <input matInput type="text" [(ngModel)]="newRegistroCaja.nrocomprobante"
                          placeholder="Nro. Factura/Comprobante" name="nrocomprobante" #nrocomprobante="ngModel" />
                  </mat-form-field>
              </div>
              <div class="form-group proveedor">
                <mat-form-field>
                  <mat-label for="proveedor_id">Proveedor</mat-label>
                  <mat-select name="proveedor_id" [(ngModel)]="newRegistroCaja.proveedor_id">
                      <mat-option></mat-option>
                      <mat-option *ngFor="let p of proveedores;" [value]="p.id">
                          {{p.descripcion}}
                      </mat-option>
                  </mat-select>
              </mat-form-field>
              </div>
              <div class="form-group nroordenpago">
                  <mat-form-field>
                      <input matInput type="text" [(ngModel)]="newRegistroCaja.nroordenpago"
                          placeholder="Nro. Orden Pago" name="nroordenpago" #nroordenpago="ngModel" />
                  </mat-form-field>
              </div>
          </div>
          <div class="rowtres">
              <div class="form-group formapago">
                  <mat-form-field>
                      <mat-label for="formapago_id">Forma Pago</mat-label>
                      <mat-select name="formapago_id" [(ngModel)]="newRegistroCaja.formapago_id" required>
                          <mat-option></mat-option>
                          <mat-option *ngFor="let fp of formaPagos;" [value]="fp.id">
                              {{fp.descripcion}}
                          </mat-option>
                      </mat-select>
                  </mat-form-field>
              </div>
              <div class="form-group importe">
                  <mat-form-field>
                      <input matInput type="text" [(ngModel)]="newRegistroCaja.importe" placeholder="Importe"
                          name="importe" #importe="ngModel" required />
                  </mat-form-field>
              </div>
          </div>
          <div class="rowcuatro">
              <mat-form-field class="example-full-width">
                  <textarea matInput placeholder="Escribe una descripcion..." name="descripcion"
                      #descripcion="ngModel" [(ngModel)]="newRegistroCaja.descripcion">
                  </textarea>
              </mat-form-field>
          </div>
          <div class="rowcinco">
              <button mat-raised-button color="primary" type="submit">
                  <mat-icon>save</mat-icon> Guardar
              </button>
          </div>
      </form>
  </mat-card>
</div>
<div class="container mt-3">
    <mat-card class="mat-elevation-z4 mt-3">
        <h3 style="color:#3a6dbc"><i class="fa fa-book"></i> Consultar Registros</h3>
        <div class="rowDate">
            <div class="form-group rangofechas">
                <mat-form-field style="width: 200px;">
                    <mat-label>Ingrese Rango Fechas</mat-label>
                    <mat-date-range-input [rangePicker]="picker">
                        <input matStartDate placeholder="Start date" (dateChange)="onChangeDateStart($event)"
                            [value]="today">
                        <input matEndDate placeholder="End date" (dateChange)="onChangeDateEnd($event)" [value]="">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                </mat-form-field>
            </div>
            <div class="form-group findfield">
                <mat-form-field style="width: 150px;">
                    <mat-label for="concepto_id">Concepto</mat-label>
                    <mat-select name="concepto_id" [(ngModel)]="findConcepto_id"
                        (ngModelChange)="changeFindConceptos($event)">
                        <mat-option></mat-option>
                        <mat-option *ngFor="let concepto of findConceptos;" [value]="concepto.id">
                            {{concepto.descripcion}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="form-group findfield" *ngIf="findConcepto_id">
                <mat-form-field style="width: 150px;">
                    <mat-label for="subconcepto_id">Subconcepto</mat-label>
                    <mat-select name="subconcepto_id" [(ngModel)]="findSubconcepto_id">
                        <mat-option></mat-option>
                        <mat-option *ngFor="let subconcepto of findSubConceptos;" [value]="subconcepto.id">
                            {{subconcepto.descripcion}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="form-group findfield">
                <mat-form-field style="width: 150px;">
                    <mat-label for="useragenda_id">Forma Pago</mat-label>
                    <mat-select name="useragenda_id" [(ngModel)]="findFormapago_id">
                        <mat-option></mat-option>
                        <mat-option *ngFor="let fp of formaPagos;" [value]="fp.id">
                            {{fp.descripcion}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="form-group findfield">
                <button mat-raised-button color="primary" type="button" [disabled]="saveDisabled"
                    (click)="getRegistrosCaja()">
                    <mat-icon>manage_search</mat-icon> Consultar
                </button>
            </div>
            <div class="form-group findfield">
                <button mat-raised-button [ngClass]="{'btnexcel': showMyClass}" type="button" [disabled]="btnExcel"
                (click)="exporter.exportTable('csv', {fileName:'CajaGeneral'+fechaDesde+'-'+fechaHasta, sheet: 'sheet_name', Props: {Author: 'Admin COL'}})">
                <mat-icon>save_alt</mat-icon>Exportar Excel
            </button>
            </div>
        </div>
    </mat-card>
    <div class="example-container mat-elevation-z4 mt-3">
        <mat-card style="width: 100%;">
            <mat-card-content>
                <div class="cajarow">
                    <div  class="form-group">
                     Total Ingreso: ${{totalFindIngreso | number}} 
                    </div>
                    <div  class="form-group">
                     Total Egreso: ${{totalFindEgreso | number}} 
                    </div>
                    <div  class="form-group">
                     Total Neto: ${{totalFindNeto | number}} 
                    </div>
                 </div>   
            </mat-card-content>
        </mat-card>
        <mat-table [dataSource]="dataSource">
            <!-- fecha Column -->
            <ng-container matColumnDef="fecha">
                <mat-header-cell *matHeaderCellDef> Fecha </mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.fecha}}</mat-cell>
            </ng-container>
            <!-- Concepto Column -->
            <ng-container matColumnDef="concepto">
                <mat-header-cell *matHeaderCellDef>Concepto</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.concepto.descripcion}}</mat-cell>
            </ng-container>
            <!-- SubConcepto Column -->
            <ng-container matColumnDef="subconcepto">
                <mat-header-cell *matHeaderCellDef>Subconcepto</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.subconcepto.descripcion}} {{caja.proveedor?'('+caja.proveedor?.descripcion+')':''}}</mat-cell>
            </ng-container>          
            <!-- Formapago Column -->
            <ng-container matColumnDef="formapago">
                <mat-header-cell *matHeaderCellDef>Forma Pago</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.formapago?.descripcion}}</mat-cell>
            </ng-container>
            <!-- Importe Column -->
            <ng-container matColumnDef="importe">
                <mat-header-cell *matHeaderCellDef>Importe</mat-header-cell>
                <mat-cell *matCellDef="let caja">
                    <span class="{{getColorEtiqueta(caja.tiporegistro)}}">${{caja.importe}}</span>
                </mat-cell>
            </ng-container>
            <!-- Acciones Column -->
            <ng-container matColumnDef="acciones">
                <mat-header-cell *matHeaderCellDef></mat-header-cell>
                <mat-cell *matCellDef="let caja">
                    <button ngbTooltip="Ver Registro" type="button" class="btn btn-sm"
                        (click)="openDialogRegistroCaja(caja)">
                        <i class="fa fa-list fa-lg"></i>
                    </button>
                    <button ngbTooltip="Editar Registro" type="button"
                        class="btn btn-sm" (click)="editarRegistroCaja(caja)">
                        <i class="fa fa-pencil fa-lg"></i>
                    </button>
                    <button ngbTooltip="Eliminar Registro" type="button"
                        class="btn btn-sm" (click)="dialogEliminarRegistro(caja)">
                        <i class="fa fa-trash fa-lg"></i>
                    </button>
                </mat-cell>
            </ng-container>
            <mat-header-row *matHeaderRowDef="displayedColumnsCaja"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumnsCaja;"></mat-row>
        </mat-table>
        <mat-paginator [pageSizeOptions]="[50, 100, 150, 200]"></mat-paginator>
    </div>
    <div style="display: none;">
        <mat-table  matTableExporter [dataSource]="dataSource" #exporter="matTableExporter">
            <!-- fecha Column -->
            <ng-container matColumnDef="fecha">
                <mat-header-cell *matHeaderCellDef> Fecha </mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.fecha}}</mat-cell>
            </ng-container>
             <!-- Registro Column -->
             <ng-container matColumnDef="tiporegistro">
                <mat-header-cell *matHeaderCellDef>Tipo Registro</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.tiporegistro.descripcion}}</mat-cell>
            </ng-container>
            <!-- Concepto Column -->
            <ng-container matColumnDef="concepto">
                <mat-header-cell *matHeaderCellDef>Concepto</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.concepto.descripcion}}</mat-cell>
            </ng-container>
            <!-- SubConcepto Column -->
            <ng-container matColumnDef="subconcepto">
                <mat-header-cell *matHeaderCellDef>Subconcepto</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.subconcepto.descripcion}}</mat-cell>
            </ng-container>
            <!-- Descripcion Column -->
            <ng-container matColumnDef="descripcion">
                <mat-header-cell *matHeaderCellDef>Descripcion</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.descripcion}}</mat-cell>
            </ng-container>
            <!-- Formapago Column -->
            <ng-container matColumnDef="formapago">
                <mat-header-cell *matHeaderCellDef>Forma Pago</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.formapago?.descripcion}}</mat-cell>
            </ng-container>
            <!-- Importe Column -->
            <ng-container matColumnDef="importe">
                <mat-header-cell *matHeaderCellDef>Importe</mat-header-cell>
                <mat-cell *matCellDef="let caja"> {{caja.importe}}</mat-cell>
            </ng-container>           
            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table> 
    </div>
</div>